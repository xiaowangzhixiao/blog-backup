---
title: JVM虚拟机学习
toc: true
comments: true
date: 2019-11-17 12:07:51
tags:
- Java
- JVM
category:
- 编程
- Java
---

## 结构
JVM虚拟机由执行子系统和运行时数据区组成，执行子系统由类装载系统和字节码执行引擎组成

## 运行时数据区
运行时数据区由以下几个组成：方法区、栈、本地方法栈、堆、程序计数器
### 栈
线程私有的，描述了Java方法执行的内存模型，每个方法运行时创建一个栈帧，栈帧存储本方法的局部变量表、操作数栈、动态链接、方法出口
#### 操作数栈
作为字节码命令时存放操作数
#### 动态链接
#### 方法出口
方法返回的地址
### 程序计数器
线程私有的，用于记录当前线程执行的的指令的位置
### 方法区
在1.8之前叫做永久代，1.8之后通常称为元空间。

用来存储已加载堆类信息、常量、静态变量、即时编译器编译后的代码等数据

### 本地方法栈
运行本地方法的栈空间


## 堆内存
堆内存分为年轻代和老年代，年轻代；年轻代和老年代的比例一般为1:2
### 年轻代
在老年代的垃圾回收称为minor gc；年轻代分为Eden区和Survivor区的from和to，Eden和From和To比例一般为8:1:1
#### Eden
较小的对象在创建时放入Eden区，当Eden区满时触发minor gc，使用复制算法堆Eden区和From区的对象进行收集复制到To区，并且对象的age加一
#### Survivor
Survivor设置两区，0和1，通常将当前存放对象的区称为From区，当前空闲的、下一次minor gc要使用的区称为To区，当minor gc多次后，对象的age达到设置的MaxTenuringThreshold（默认为15）后，或是Survivor区同年龄的对象大小总和大于一个Survivor空间的一半的大于等于该年龄的对象，或是回收后Survivor区放不下的对象认为是长期存在的对象，将会放入老年代
### 老年代
老年代的GC称为full gc一般使用标记整理算法
